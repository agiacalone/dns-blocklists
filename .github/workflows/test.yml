name: Test
on:
  workflow_dispatch:
permissions:
  actions: write
  contents: write
  issues: write
jobs:
  relabel-issues:
    runs-on: ubuntu-latest
    steps:
      - name: relabel
        uses: actions/github-script@v7
        with:
          script: |
            const labelToFind = 'scheduled-next-release';
            const labelToAdd = 'fixed-pending-release';
            const per_page = 100;
            let page = 1;
            let issues = [];

            while (true) {
              const { data } = await github.rest.issues.listForRepo({
                owner: context.repo.owner,
                repo: context.repo.repo,
                state: 'open',
                labels: labelToFind,
                per_page,
                page
              });
              if (data.length === 0) break;
              issues = issues.concat(data);
              page++;
            }

            for (const issue of issues) {
              await github.rest.issues.removeLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                name: labelToFind
              });
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: [labelToAdd]
              });
              console.log(`Issue #${issue.number} relabled.`);
            }
